{
    "sourceFile": "src/views/modules/inspection/inspectionline.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 8,
            "patches": [
                {
                    "date": 1622102346013,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1622102441606,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1240,13 +1240,15 @@\n           })\r\n         }\r\n \r\n         if (this.publishName === '发布计划') {\r\n+          startLoading();\r\n           this.$http({\r\n             url: this.$http.adornUrl(`/inspection/inspectionline/publish/${this.lineForm.lineId}`),\r\n             method: 'post'\r\n           }).then(({data}) => {\r\n             if (data && data.code === 0) {\r\n+              endLoading();\r\n               this.$message({\r\n                 message: '操作成功',\r\n                 type: 'success',\r\n                 duration: 1500,\r\n@@ -1263,8 +1265,9 @@\n                   this.isPublish = 1\r\n                 }\r\n               })\r\n             } else {\r\n+              endLoading();\r\n               this.$message.error(data.msg)\r\n             }\r\n           })\r\n         }\r\n"
                },
                {
                    "date": 1622102805439,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1240,15 +1240,13 @@\n           })\r\n         }\r\n \r\n         if (this.publishName === '发布计划') {\r\n-          startLoading();\r\n           this.$http({\r\n             url: this.$http.adornUrl(`/inspection/inspectionline/publish/${this.lineForm.lineId}`),\r\n             method: 'post'\r\n           }).then(({data}) => {\r\n             if (data && data.code === 0) {\r\n-              endLoading();\r\n               this.$message({\r\n                 message: '操作成功',\r\n                 type: 'success',\r\n                 duration: 1500,\r\n@@ -1265,9 +1263,8 @@\n                   this.isPublish = 1\r\n                 }\r\n               })\r\n             } else {\r\n-              endLoading();\r\n               this.$message.error(data.msg)\r\n             }\r\n           })\r\n         }\r\n@@ -1286,18 +1283,8 @@\n           this.$router.push({name: 'inspection-pda', params: {pdaName: pdaName}})\r\n         } else {\r\n           this.$alert('您没有开通页面权限')\r\n         }\r\n-      },\r\n-      startLoading: function() {\r\n-        loading = Loading.service({\r\n-            lock: true,\r\n-            text: '加载中……',\r\n-            background: 'rgba(0, 0, 0, 0.7)'\r\n-        })\r\n-      },\r\n-      endLoading: function() {\r\n-          loading.close()\r\n       }\r\n     }\r\n   }\r\n </script>\r\n"
                },
                {
                    "date": 1622103395652,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -520,8 +520,11 @@\n   import PeriodAddOrUpdate from './inspectionperiod-add-or-update'\r\n   import ZoneBindAddOrUpdate from './zonebind-add-or-update'\r\n   import ViewPublish from './inspectionlinepublish'\r\n   import splitPane from '@/components/split-pane'\r\n+\r\n+  var modifyLock = false;//修改计划防重复提交锁\r\n+  var publishLock = flse;//发布计划防重复提交锁\r\n   export default {\r\n     data () {\r\n       return {\r\n         lineForm: {\r\n@@ -1201,14 +1204,18 @@\n         if (this.lineForm.lineId === 0 || this.lineForm.lineId === null) {\r\n           this.$alert('请选择线路')\r\n           return\r\n         }\r\n+        if(lock){\r\n+          return\r\n+        }\r\n         if (this.publishName === '修改计划') {\r\n           this.$confirm(`确定将线路由已发布状态改为编操状态作?`, '提示', {\r\n             confirmButtonText: '确定',\r\n             cancelButtonText: '取消',\r\n             type: 'warning'\r\n           }).then(() => {\r\n+            lock = true;\r\n             this.$http({\r\n               url: this.$http.adornUrl('/inspection/inspectionline/update'),\r\n               method: 'post',\r\n               data: this.$http.adornData({\r\n@@ -1235,13 +1242,15 @@\n                 })\r\n               } else {\r\n                 this.$message.error(data.msg)\r\n               }\r\n+              lock = false;\r\n             })\r\n           })\r\n         }\r\n \r\n         if (this.publishName === '发布计划') {\r\n+          lock = true;\r\n           this.$http({\r\n             url: this.$http.adornUrl(`/inspection/inspectionline/publish/${this.lineForm.lineId}`),\r\n             method: 'post'\r\n           }).then(({data}) => {\r\n@@ -1265,8 +1274,9 @@\n               })\r\n             } else {\r\n               this.$message.error(data.msg)\r\n             }\r\n+             lock = false;\r\n           })\r\n         }\r\n       },\r\n       // 跳转到 对应的巡区页面\r\n"
                },
                {
                    "date": 1622103420521,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1205,16 +1205,18 @@\n           this.$alert('请选择线路')\r\n           return\r\n         }\r\n         if(lock){\r\n+          alert()\r\n           return\r\n         }\r\n         if (this.publishName === '修改计划') {\r\n           this.$confirm(`确定将线路由已发布状态改为编操状态作?`, '提示', {\r\n             confirmButtonText: '确定',\r\n             cancelButtonText: '取消',\r\n             type: 'warning'\r\n           }).then(() => {\r\n+            alert(1)\r\n             lock = true;\r\n             this.$http({\r\n               url: this.$http.adornUrl('/inspection/inspectionline/update'),\r\n               method: 'post',\r\n"
                },
                {
                    "date": 1622103439566,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1208,8 +1208,9 @@\n         if(lock){\r\n           alert()\r\n           return\r\n         }\r\n+        alert(2)\r\n         if (this.publishName === '修改计划') {\r\n           this.$confirm(`确定将线路由已发布状态改为编操状态作?`, '提示', {\r\n             confirmButtonText: '确定',\r\n             cancelButtonText: '取消',\r\n"
                },
                {
                    "date": 1622103457705,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -521,10 +521,9 @@\n   import ZoneBindAddOrUpdate from './zonebind-add-or-update'\r\n   import ViewPublish from './inspectionlinepublish'\r\n   import splitPane from '@/components/split-pane'\r\n \r\n-  var modifyLock = false;//修改计划防重复提交锁\r\n-  var publishLock = flse;//发布计划防重复提交锁\r\n+  var lock = false;\r\n   export default {\r\n     data () {\r\n       return {\r\n         lineForm: {\r\n"
                },
                {
                    "date": 1622103473408,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -521,9 +521,9 @@\n   import ZoneBindAddOrUpdate from './zonebind-add-or-update'\r\n   import ViewPublish from './inspectionlinepublish'\r\n   import splitPane from '@/components/split-pane'\r\n \r\n-  var lock = false;\r\n+  var lock = false;//修改发布计划防重复提交锁\r\n   export default {\r\n     data () {\r\n       return {\r\n         lineForm: {\r\n"
                },
                {
                    "date": 1622103605537,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1204,19 +1204,16 @@\n           this.$alert('请选择线路')\r\n           return\r\n         }\r\n         if(lock){\r\n-          alert()\r\n           return\r\n         }\r\n-        alert(2)\r\n         if (this.publishName === '修改计划') {\r\n           this.$confirm(`确定将线路由已发布状态改为编操状态作?`, '提示', {\r\n             confirmButtonText: '确定',\r\n             cancelButtonText: '取消',\r\n             type: 'warning'\r\n           }).then(() => {\r\n-            alert(1)\r\n             lock = true;\r\n             this.$http({\r\n               url: this.$http.adornUrl('/inspection/inspectionline/update'),\r\n               method: 'post',\r\n"
                }
            ],
            "date": 1622102346013,
            "name": "Commit-0",
            "content": "<template>\r\n  <div class=\"mod-inspection-line\" style=\"height: 100%;\">\r\n    <div class=\"show-data-content\">\r\n    <split-pane split=\"vertical\" ref=\"splitPane\"  :min-percent=\"0\" :default-percent=\"curPercent\" @resize=\"resize\">\r\n      <template slot=\"paneL\" >\r\n        <div class=\"show-left\">\r\n        <div class=\"org_title\">\r\n          <span v-if=\"this.isDrawBack===false\" style=\"vertical-align: middle;\">机构列表</span><i :class=\"drawBackClass\" style=\"float:right;cursor:pointer;\" @click=\"onDrawBack\"></i>\r\n        </div>\r\n        <depttree @deptSelectEvent=\"handleDeptSelect\" v-if=\"this.isDrawBack===false\"></depttree>\r\n        </div>\r\n      </template>\r\n   <template slot=\"paneR\">\r\n    <div class=\"show-data-table\">\r\n      <div class=\"show-data-up\" style=\"flex: 1;\">\r\n          <el-form :inline=\"true\" :model=\"lineForm\" @keyup.enter.native=\"search()\">\r\n            <el-form-item>\r\n              <el-input v-model=\"lineForm.name\" placeholder=\"线路名称\" clearable size=\"mini\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button @click=\"search()\" size=\"mini\">查询</el-button>\r\n              <el-button v-if=\"isAuth('inspection:inspectionline:save')\" @click=\"lineAddOrUpdateHandle()\" size=\"mini\">新增</el-button>\r\n              <el-button v-if=\"isAuth('inspection:inspectionline:publish')\" @click=\"linePublish()\" :icon=\"publishIcon\" size=\"mini\">{{publishName}}</el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n        <!--height=\"calc(100% - 50px) !important\"-->\r\n          <el-table\r\n            height=\"210\"\r\n            border\r\n            :data=\"lineList\"\r\n            v-loading=\"lineListLoading\"\r\n            highlight-current-row\r\n            @current-change=\"lineSelectionChangeHandle\"\r\n            :cell-style=\"cellStyle\"\r\n            :row-style=\"rowStyle\"\r\n            style=\"width: 100%;\">\r\n            <el-table-column\r\n              fixed\r\n              type=\"index\"\r\n              header-align=\"center\"\r\n              align=\"center\">\r\n            </el-table-column>\r\n            <el-table-column\r\n              fixed\r\n              prop=\"name\"\r\n              min-width=\"180\"\r\n              header-align=\"center\"\r\n              align=\"center\"\r\n              label=\"线路名称\">\r\n            </el-table-column>\r\n            <el-table-column\r\n              prop=\"deptName\"\r\n              header-align=\"center\"\r\n              align=\"center\"\r\n              label=\"所属机构\">\r\n            </el-table-column>\r\n            <el-table-column\r\n              prop=\"typeName\"\r\n              header-align=\"center\"\r\n              align=\"center\"\r\n              width=\"80\"\r\n              label=\"巡检类型\">\r\n            </el-table-column>\r\n            <el-table-column\r\n              prop=\"periodTypeName\"\r\n              header-align=\"center\"\r\n              align=\"center\"\r\n              width=\"80\"\r\n              label=\"巡检周期\">\r\n            </el-table-column>\r\n            <el-table-column\r\n              prop=\"isPublish\"\r\n              header-align=\"center\"\r\n              align=\"center\"\r\n              width=\"80\"\r\n              label=\"发布\">\r\n              <template slot-scope=\"scope\">\r\n                <el-tooltip effect=\"dark\" content=\"未发布\" placement=\"top-start\">\r\n                  <span class=\"el-icon-edit-outline\" v-if=\"scope.row.isPublish === 0\" style=\"font-size:16px;\"></span>\r\n                </el-tooltip>\r\n                <el-tooltip effect=\"light\" content=\"已发布\" placement=\"top-start\">\r\n                  <span class=\"el-icon-check\" v-if=\"scope.row.isPublish === 1\" style=\"color:darkgreen;font-size:16px;\"></span>\r\n                </el-tooltip>\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column\r\n              prop=\"downloadStatus\"\r\n              header-align=\"center\"\r\n              align=\"center\"\r\n              width=\"80\"\r\n              label=\"下载状态\">\r\n            </el-table-column>\r\n            <el-table-column\r\n              prop=\"updateTime\"\r\n              header-align=\"center\"\r\n              align=\"center\"\r\n              width=\"150\"\r\n              label=\"修改时间\">\r\n            </el-table-column>\r\n            <el-table-column\r\n              prop=\"orderNum\"\r\n              header-align=\"center\"\r\n              align=\"center\"\r\n              width=\"60\"\r\n              label=\"排序\">\r\n            </el-table-column>\r\n            <el-table-column\r\n              header-align=\"center\"\r\n              align=\"center\"\r\n              width=\"150\"\r\n              label=\"操作\">\r\n              <template slot-scope=\"scope\" sytle=\"z-index=1;\">\r\n                <el-button v-if=\"isAuth('inspection:inspectionline:save') && scope.row.isPublish===0\" type=\"text\" size=\"mini\" @click=\"lineAddOrUpdateHandle(scope.row.id)\">修改</el-button>\r\n                <el-button v-if=\"isAuth('inspection:inspectionline:delete') && scope.row.isPublish===0\" type=\"text\" size=\"mini\" @click=\"lineDeleteHandle(scope.row.id)\">删除</el-button>\r\n                <el-button v-if=\"scope.row.isPublish===1\" type=\"text\" size=\"mini\" @click=\"viewPublish(scope.row.id)\" >下载详情</el-button>\r\n              </template>\r\n            </el-table-column>\r\n          </el-table>\r\n          <el-pagination\r\n            @size-change=\"lineSizeChangeHandle\"\r\n            @current-change=\"lineCurrentChangeHandle\"\r\n            :current-page=\"linePageIndex\"\r\n            :page-sizes=\"[5, 10, 20, 50]\"\r\n            :page-size=\"linePageSize\"\r\n            :total=\"lineTotalPage\"\r\n            style=\"margin-bottom: 5px;\"\r\n            layout=\"total, sizes, prev, pager, next, jumper\">\r\n          </el-pagination>\r\n          <!-- 弹窗, 新增 / 修改 -->\r\n          <LineAddOrUpdate v-if=\"lineAddOrUpdateVisible\" ref=\"lineAddOrUpdate\" @refreshDataList=\"getLineList(lineForm.deptId)\"></LineAddOrUpdate>\r\n          <viewPublish v-if=\"viewPublishVisible\" ref=\"viewPublish\" @refreshDataList=\"getLineList(lineForm.deptId)\" v-on:closeMain=\"closeMain\"></viewPublish>\r\n      </div>\r\n      <div class=\"show-data-down\" style=\"flex: 1;display: flex;flex-direction: column;\">\r\n      <el-tabs type=\"border-card\" v-model=\"activeTab\" @tab-click=\"tabSelectChangeHandle\" class=\"xunxian\" style=\"height: 100%;\">\r\n      <el-tab-pane label=\"班组\" name=\"class\">\r\n          <div class=\"mod-class-group bottom_data\">\r\n            <el-form :inline=\"true\">\r\n              <el-form-item>\r\n                <el-button v-if=\"isAuth('inspection:classgroup:save') && isPublish===0\"  @click=\"classGroupAddOrUpdateHandle()\" :disabled=\"lineForm.lineId <= 0\" size=\"mini\">新增</el-button>\r\n                <el-button v-if=\"isAuth('inspection:classgroup:delete') && isPublish===0\" type=\"warning\" @click=\"classGroupDeleteHandle()\" :disabled=\"classGroupListSelections.length <= 0\" size=\"mini\">批量解绑</el-button>\r\n              </el-form-item>\r\n            </el-form>\r\n            <el-table\r\n              :data=\"classGroupList\"\r\n              border\r\n              height=\"10px\"\r\n              v-loading=\"classGroupListLoading\"\r\n              @selection-change=\"classGroupSelectionChangeHandle\"\r\n              :cell-style=\"cellStyle\"\r\n              :row-style=\"rowStyle\"\r\n              style=\"width: 100%;\">\r\n              <el-table-column\r\n                type=\"selection\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                width=\"50\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                type=\"index\"\r\n                header-align=\"center\"\r\n                align=\"center\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"name\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"名称\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"workerNames\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"用户\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                fixed=\"right\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                width=\"150\"\r\n                label=\"操作\">\r\n                <template slot-scope=\"scope\">\r\n                  <el-button v-if=\"isAuth('inspection:classgroup:save') && isPublish===0\" type=\"text\" size=\"mini\" @click=\"classGroupAddOrUpdateHandle(scope.row.id)\">修改</el-button>\r\n                  <el-button v-if=\"isAuth('inspection:classgroup:delete') && isPublish===0\" type=\"text\" size=\"mini\" @click=\"classGroupDeleteHandle(scope.row.id)\">解绑</el-button>\r\n                </template>\r\n              </el-table-column>\r\n            </el-table>\r\n            <el-pagination\r\n              @size-change=\"classGroupSizeChangeHandle\"\r\n              @current-change=\"classGroupCurrentChangeHandle\"\r\n              :current-page=\"classGroupPageIndex\"\r\n              :page-sizes=\"[5, 10, 20, 50]\"\r\n              :page-size=\"classGroupPageSize\"\r\n              :total=\"classGroupTotalPage\"\r\n              layout=\"total, sizes, prev, pager, next, jumper\">\r\n            </el-pagination>\r\n            <!-- 弹窗, 新增 / 修改 -->\r\n            <ClassGroupAddOrUpdate v-if=\"classGroupAddOrUpdateVisible\" ref=\"classGroupAddOrUpdate\" @refreshDataList=\"getClassGroupList\"></ClassGroupAddOrUpdate>\r\n          </div>\r\n        </el-tab-pane>\r\n        <el-tab-pane label=\"轮次\" name=\"turn\">\r\n         <div class=\"mod-turn bottom_data\">\r\n            <el-form :inline=\"true\">\r\n              <el-form-item>\r\n                <el-button v-if=\"isAuth('inspection:turn:save') && isPublish===0\" @click=\"turnAddOrUpdateHandle()\" :disabled=\"lineForm.lineId <= 0\" size=\"mini\">新增</el-button>\r\n                <el-button v-if=\"isAuth('inspection:turn:delete') && isPublish===0\" type=\"warning\" @click=\"turnDeleteHandle()\" :disabled=\"turnListSelections.length <= 0\" size=\"mini\">批量解绑</el-button>\r\n              </el-form-item>\r\n            </el-form>\r\n            <el-table height=\"360\"\r\n              :data=\"turnList\"\r\n              border\r\n              v-loading=\"turnListLoading\"\r\n              @selection-change=\"turnSelectionChangeHandle\"\r\n              :cell-style=\"cellStyle\"\r\n              :row-style=\"rowStyle\"\r\n              style=\"width: 100%;\">\r\n              <el-table-column\r\n                type=\"selection\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                width=\"50\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                type=\"index\"\r\n                header-align=\"center\"\r\n                align=\"center\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"name\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"名称\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"classGroupNames\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"班组集合\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"startTime\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"开始时间\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"endTime\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"结束时间\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                fixed=\"right\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                width=\"150\"\r\n                label=\"操作\">\r\n                <template slot-scope=\"scope\">\r\n                  <el-button v-if=\"isAuth('inspection:turn:save') && isPublish===0\" type=\"text\" size=\"mini\" @click=\"turnAddOrUpdateHandle(scope.row.id)\">修改</el-button>\r\n                  <el-button v-if=\"isAuth('inspection:turn:delete') && isPublish===0\" type=\"text\" size=\"mini\" @click=\"turnDeleteHandle(scope.row.id)\">解绑</el-button>\r\n                </template>\r\n              </el-table-column>\r\n            </el-table>\r\n            <el-pagination\r\n              @size-change=\"turnSizeChangeHandle\"\r\n              @current-change=\"turnCurrentChangeHandle\"\r\n              :current-page=\"turnPageIndex\"\r\n              :page-sizes=\"[5, 10, 20, 50]\"\r\n              :page-size=\"turnPageSize\"\r\n              :total=\"turnTotalPage\"\r\n              layout=\"total, sizes, prev, pager, next, jumper\">\r\n            </el-pagination>\r\n            <!-- 弹窗, 新增 / 修改 -->\r\n            <TurnAddOrUpdate v-if=\"turnAddOrUpdateVisible\" ref=\"turnAddOrUpdate\" @refreshDataList=\"getTurnList\"></TurnAddOrUpdate>\r\n          </div>\r\n        </el-tab-pane>\r\n        <el-tab-pane label=\"周期\" name=\"period\">\r\n          <div class=\"mod-period bottom_data\">\r\n            <el-form :inline=\"true\">\r\n              <el-form-item>\r\n                <el-button v-if=\"isAuth('inspection:inspectionperiod:save') && isPublish===0\" @click=\"periodAddOrUpdateHandle()\" :disabled=\"lineForm.lineId <= 0\" size=\"mini\">新增</el-button>\r\n                <el-button v-if=\"isAuth('inspection:inspectionperiod:delete') && isPublish===0\" type=\"warning\" @click=\"periodDeleteHandle()\" :disabled=\"periodListSelections.length <= 0\" size=\"mini\">批量解绑</el-button>\r\n              </el-form-item>\r\n            </el-form>\r\n            <el-table height=\"360\"\r\n              :data=\"periodList\"\r\n              border\r\n              v-loading=\"periodListLoading\"\r\n              @selection-change=\"periodSelectionChangeHandle\"\r\n              :cell-style=\"cellStyle\"\r\n              :rowStyle=\"rowStyle\"\r\n              style=\"width: 100%;\">\r\n              <el-table-column\r\n                type=\"selection\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                width=\"50\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                type=\"index\"\r\n                header-align=\"center\"\r\n                align=\"center\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"name\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"名称\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"basePoint\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"开始时间\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"frequency\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                width=\"50\"\r\n                label=\"频度\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"startPoint\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"跨度起点\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"span\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                width=\"50\"\r\n                label=\"跨度\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"turnFinishModName\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"完成模式\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"turnNames\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"轮次集合\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                fixed=\"right\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                width=\"110\"\r\n                label=\"操作\">\r\n                <template slot-scope=\"scope\">\r\n                  <el-button v-if=\"isAuth('inspection:inspectionperiod:save') && isPublish===0\" type=\"text\" size=\"mini\" @click=\"periodAddOrUpdateHandle(scope.row.id)\">修改</el-button>\r\n                  <el-button v-if=\"isAuth('inspection:inspectionperiod:delete') && isPublish===0\" type=\"text\" size=\"mini\" @click=\"periodDeleteHandle(scope.row.id)\">解绑</el-button>\r\n                </template>\r\n              </el-table-column>\r\n            </el-table>\r\n            <el-pagination\r\n              @size-change=\"periodSizeChangeHandle\"\r\n              @current-change=\"periodCurrentChangeHandle\"\r\n              :current-page=\"periodPageIndex\"\r\n              :page-sizes=\"[5, 10, 20, 50]\"\r\n              :page-size=\"periodPageSize\"\r\n              :total=\"periodTotalPage\"\r\n              layout=\"total, sizes, prev, pager, next, jumper\">\r\n            </el-pagination>\r\n            <!-- 弹窗, 新增 / 修改 -->\r\n            <PeriodAddOrUpdate v-if=\"periodAddOrUpdateVisible\" ref=\"periodAddOrUpdate\" @refreshDataList=\"getPeriodList\"></PeriodAddOrUpdate>\r\n          </div>\r\n        </el-tab-pane>\r\n        <el-tab-pane label=\"巡区\" name=\"zone\">\r\n          <div class=\"mod-line-zone bottom_data\">\r\n            <el-form :inline=\"true\">\r\n              <el-form-item>\r\n                <el-button v-if=\"isAuth('inspection:linezone:save') && isPublish===0\" @click=\"zoneBindAddOrUpdateHandle()\" :disabled=\"lineForm.lineId <= 0\" size=\"mini\">绑定</el-button>\r\n                <el-button v-if=\"isAuth('inspection:linezone:delete') && isPublish===0\" type=\"warning\" @click=\"lineZoneDeleteHandle()\" :disabled=\"lineZoneListSelections.length <= 0\" size=\"mini\">批量解绑</el-button>\r\n              </el-form-item>\r\n            </el-form>\r\n            <el-table height=\"360\"\r\n              :data=\"lineZoneList\"\r\n              border\r\n              v-loading=\"lineZoneListLoading\"\r\n              @selection-change=\"lineZoneSelectionChangeHandle\"\r\n              :cell-style=\"cellStyle\"\r\n              :row-style=\"rowStyle\"\r\n              style=\"width: 100%;\">\r\n              <el-table-column\r\n                type=\"selection\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                width=\"50\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                type=\"index\"\r\n                header-align=\"center\"\r\n                align=\"center\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"zoneName\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"名称\">\r\n                <template slot-scope=\"scope\">\r\n                  <a href=\"#\" style=\"text-decoration: none;color: black;\"><span  @click=clickToZone(scope.row.zoneName)>{{scope.row.zoneName}}</span></a>\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"zoneCode\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"编码\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                fixed=\"right\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                width=\"150\"\r\n                label=\"操作\">\r\n                <template slot-scope=\"scope\">\r\n                  <el-button v-if=\"isAuth('inspection:linezone:delete') && isPublish===0\" type=\"text\" size=\"mini\" @click=\"lineZoneDeleteHandle(scope.row.id)\">解绑</el-button>\r\n                </template>\r\n              </el-table-column>\r\n            </el-table>\r\n            <el-pagination\r\n              @size-change=\"lineZoneSizeChangeHandle\"\r\n              @current-change=\"lineZoneCurrentChangeHandle\"\r\n              :current-page=\"lineZonePageIndex\"\r\n              :page-sizes=\"[5, 10, 20, 50]\"\r\n              :page-size=\"lineZonePageSize\"\r\n              :total=\"lineZoneTotalPage\"\r\n              layout=\"total, sizes, prev, pager, next, jumper\">\r\n            </el-pagination>\r\n            <!-- 弹窗, 新增 / 修改 -->\r\n            <ZoneBindAddOrUpdate v-if=\"lineZoneAddOrUpdateVisible\" v-model=\"lineZoneAddOrUpdateVisible\" ref=\"zoneBindAddOrUpdate\" @refreshDataList=\"getLineZoneList\" @ZoneBindEvent=\"zoneBindEvent\"></ZoneBindAddOrUpdate>\r\n          </div>\r\n        </el-tab-pane>\r\n        <el-tab-pane label=\"PDA\" name=\"pda\">\r\n          <div class=\"mod-line-pda bottom_data\">\r\n            <el-form :inline=\"true\">\r\n              <el-form-item>\r\n                <el-button v-if=\"isAuth('inspection:inspectionlinepublish:save') && isPublish===0\" @click=\"pdaBindAddOrUpdateHandle()\" :disabled=\"lineForm.lineId <= 0\" size=\"mini\">绑定</el-button>\r\n                <el-button v-if=\"isAuth('inspection:inspectionlinepublish:delete') && isPublish===0\" type=\"warning\" @click=\"pdaDeleteHandle()\" :disabled=\"linePdaListSelections.length <= 0\" size=\"mini\">批量解绑</el-button>\r\n              </el-form-item>\r\n            </el-form>\r\n            <el-table\r\n              height=\"360\"\r\n              :data=\"linePdaList\"\r\n              border\r\n              v-loading=\"linePdaListLoading\"\r\n              @selection-change=\"linePdaSelectionChangeHandle\"\r\n              :cell-style=\"cellStyle\"\r\n              :row-style=\"rowStyle\"\r\n              style=\"width: 100%;\">\r\n              <el-table-column\r\n                type=\"selection\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                width=\"50\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                type=\"index\"\r\n                header-align=\"center\"\r\n                align=\"center\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"pdaName\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"Pda名称\">\r\n                <template slot-scope=\"scope\">\r\n                  <a href=\"#\" style=\"text-decoration: none;color: black;\"><span  @click=clickToPda(scope.row.pdaName)>{{scope.row.pdaName}}</span></a>\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"pdaMac\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                label=\"pda地址\">\r\n              </el-table-column>\r\n              <el-table-column\r\n                fixed=\"right\"\r\n                header-align=\"center\"\r\n                align=\"center\"\r\n                width=\"150\"\r\n                label=\"操作\">\r\n                <template slot-scope=\"scope\">\r\n                  <el-button v-if=\"isAuth('inspection:inspectionlinepublish:delete') && isPublish===0\" type=\"text\" size=\"mini\" @click=\"pdaDeleteHandle(scope.row.id)\">解绑</el-button>\r\n                </template>\r\n              </el-table-column>\r\n            </el-table>\r\n            <el-pagination\r\n              @size-change=\"linePdaSizeChangeHandle\"\r\n              @current-change=\"linePdaCurrentChangeHandle\"\r\n              :current-page=\"linePdaPageIndex\"\r\n              :page-sizes=\"[5, 10, 20, 50]\"\r\n              :page-size=\"linePdaPageSize\"\r\n              :total=\"linePdaTotalPage\"\r\n              layout=\"total, sizes, prev, pager, next, jumper\">\r\n            </el-pagination>\r\n            <!-- 弹窗, 新增 / 修改 -->\r\n            <PdaAddOrUpdate v-if=\"linePdaAddOrUpdateVisible\" ref=\"pdaBindAddOrUpdate\" @refreshDataList=\"getLinePdaList\" @PdaBindEvent=\"pdaBindEvent\"></PdaAddOrUpdate>\r\n          </div>\r\n        </el-tab-pane>\r\n      </el-tabs>\r\n      </div>\r\n    </div>\r\n  </template>\r\n  </split-pane>\r\n  </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import depttree from '@/components/dept-tree'\r\n  import PdaAddOrUpdate from './publish-pda'\r\n  import LineAddOrUpdate from './inspectionline-add-or-update'\r\n  import TurnAddOrUpdate from './turn-add-or-update'\r\n  import ClassGroupAddOrUpdate from './classgroup-add-or-update'\r\n  import PeriodAddOrUpdate from './inspectionperiod-add-or-update'\r\n  import ZoneBindAddOrUpdate from './zonebind-add-or-update'\r\n  import ViewPublish from './inspectionlinepublish'\r\n  import splitPane from '@/components/split-pane'\r\n  export default {\r\n    data () {\r\n      return {\r\n        lineForm: {\r\n          lineId: null,\r\n          deptId: null,\r\n          periodType: 0,\r\n          name: null\r\n        },\r\n        isPublish: 0,\r\n        publishIcon: 'el-icon-circle-check-outline',\r\n        publishName: '发布计划',\r\n        isDrawBack: false,\r\n        drawBackClass: 'el-icon-d-arrow-left',\r\n        curPercent: 12,\r\n        oldPercent: 16,\r\n        lineList: [],\r\n        turnList: [],\r\n        classGroupList: [],\r\n        periodList: [],\r\n        lineZoneList: [],\r\n        linePdaList: [],\r\n        linePageIndex: 1,\r\n        linePageSize: 5,\r\n        lineTotalPage: 0,\r\n        turnPageIndex: 1,\r\n        turnPageSize: 5,\r\n        turnTotalPage: 0,\r\n        classGroupPageIndex: 1,\r\n        classGroupPageSize: 5,\r\n        classGroupTotalPage: 0,\r\n        periodPageIndex: 1,\r\n        periodPageSize: 5,\r\n        periodTotalPage: 0,\r\n        lineZonePageIndex: 1,\r\n        lineZonePageSize: 5,\r\n        lineZoneTotalPage: 0,\r\n        linePdaPageIndex: 1,\r\n        linePdaPageSize: 5,\r\n        linePdaTotalPage: 0,\r\n        lineListLoading: false,\r\n        turnListLoading: false,\r\n        classGroupListLoading: false,\r\n        periodListLoading: false,\r\n        lineZoneListLoading: false,\r\n        linePdaListLoading: false,\r\n        lineListSelections: [],\r\n        turnListSelections: [],\r\n        classGroupListSelections: [],\r\n        periodListSelections: [],\r\n        lineZoneListSelections: [],\r\n        linePdaListSelections: [],\r\n        lineAddOrUpdateVisible: false,\r\n        turnAddOrUpdateVisible: false,\r\n        viewPublishVisible: false,\r\n        classGroupAddOrUpdateVisible: false,\r\n        periodAddOrUpdateVisible: false,\r\n        lineZoneAddOrUpdateVisible: false,\r\n        linePdaAddOrUpdateVisible: false,\r\n        activeTab: 'class',\r\n        lineSelected: false\r\n      }\r\n    },\r\n    components: {\r\n      depttree,\r\n      PdaAddOrUpdate,\r\n      LineAddOrUpdate,\r\n      TurnAddOrUpdate,\r\n      ClassGroupAddOrUpdate,\r\n      PeriodAddOrUpdate,\r\n      ZoneBindAddOrUpdate,\r\n      ViewPublish,\r\n      splitPane\r\n    },\r\n    activated () {\r\n      this.getLineList()\r\n    },\r\n    methods: {\r\n      search () {\r\n        this.lineForm.deptId = null\r\n        this.getLineList(null)\r\n      },\r\n      onDrawBack () {\r\n        this.isDrawBack = !this.isDrawBack\r\n        if (this.isDrawBack) {\r\n          this.oldPercent = this.curPercent\r\n          this.curPercent = 2.5\r\n          this.drawBackClass = 'el-icon-d-arrow-right'\r\n        } else {\r\n          this.drawBackClass = 'el-icon-d-arrow-left'\r\n          this.curPercent = this.oldPercent\r\n        }\r\n        this.$refs.splitPane.setPercent(this.curPercent)\r\n      },\r\n      resize (val) {\r\n        this.curPercent = val\r\n        console.log(val)\r\n      },\r\n      // 关闭下载详情\r\n      closeMain () {\r\n        console.log(this.viewPublishVisible)\r\n        this.viewPublishVisible = false\r\n      },\r\n      // 获取数据列表\r\n      getLineList (deptId) {\r\n        this.lineListLoading = true\r\n        this.$http({\r\n          url: this.$http.adornUrl('/inspection/inspectionline/list'),\r\n          method: 'get',\r\n          params: this.$http.adornParams({\r\n            'page': this.linePageIndex,\r\n            'limit': this.linePageSize,\r\n            'deptId': deptId,\r\n            'name': this.lineForm.name\r\n          })\r\n        }).then(({data}) => {\r\n          if (data && data.code === 0) {\r\n            this.lineList = data.page.list\r\n            this.lineTotalPage = data.page.totalCount\r\n          } else {\r\n            this.lineList = []\r\n            this.lineTotalPage = 0\r\n          }\r\n          this.lineListLoading = false\r\n        })\r\n      },\r\n      getTurnList () {\r\n        this.turnListLoading = true\r\n        this.$http({\r\n          url: this.$http.adornUrl('/inspection/turn/list'),\r\n          method: 'get',\r\n          params: this.$http.adornParams({\r\n            'page': this.turnPageIndex,\r\n            'limit': this.turnPageSize,\r\n            'inspectionLineId': this.lineForm.lineId\r\n          })\r\n        }).then(({data}) => {\r\n          if (data && data.code === 0) {\r\n            this.turnList = data.page.list\r\n            this.turnTotalPage = data.page.totalCount\r\n          } else {\r\n            this.turnList = []\r\n            this.turnTotalPage = 0\r\n          }\r\n          this.turnListLoading = false\r\n        })\r\n      },\r\n      getClassGroupList () {\r\n        this.classGroupListLoading = true\r\n        this.$http({\r\n          url: this.$http.adornUrl('/inspection/classgroup/list'),\r\n          method: 'get',\r\n          params: this.$http.adornParams({\r\n            'page': this.classGroupPageIndex,\r\n            'limit': this.classGroupPageSize,\r\n            'inspectionLineId': this.lineForm.lineId\r\n          })\r\n        }).then(({data}) => {\r\n          if (data && data.code === 0) {\r\n            this.classGroupList = data.page.list\r\n            this.classGroupTotalPage = data.page.totalCount\r\n          } else {\r\n            this.classGroupList = []\r\n            this.classGroupTotalPage = 0\r\n          }\r\n          this.classGroupListLoading = false\r\n        })\r\n      },\r\n      getPeriodList () {\r\n        this.periodListLoading = true\r\n        this.$http({\r\n          url: this.$http.adornUrl('/inspection/inspectionperiod/list'),\r\n          method: 'get',\r\n          params: this.$http.adornParams({\r\n            'page': this.periodPageIndex,\r\n            'limit': this.periodPageSize,\r\n            'lineId': this.lineForm.lineId\r\n          })\r\n        }).then(({data}) => {\r\n          if (data && data.code === 0) {\r\n            this.periodList = data.page.list\r\n            this.periodTotalPage = data.page.totalCount\r\n          } else {\r\n            this.periodList = []\r\n            this.periodTotalPage = 0\r\n          }\r\n          this.periodListLoading = false\r\n        })\r\n      },\r\n      getLineZoneList () {\r\n        this.lineZoneListLoading = true\r\n        this.$http({\r\n          url: this.$http.adornUrl('/inspection/linezone/list'),\r\n          method: 'get',\r\n          params: this.$http.adornParams({\r\n            'page': this.lineZonePageIndex,\r\n            'limit': this.lineZonePageSize,\r\n            'lineId': this.lineForm.lineId\r\n          })\r\n        }).then(({data}) => {\r\n          if (data && data.code === 0) {\r\n            this.lineZoneList = data.page.list\r\n            this.lineZoneTotalPage = data.page.totalCount\r\n          } else {\r\n            this.lineZoneList = []\r\n            this.lineZoneTotalPage = 0\r\n          }\r\n          this.lineZoneListLoading = false\r\n        })\r\n      },\r\n      getLinePdaList () {\r\n        this.linePdaListLoading = true\r\n        this.$http({\r\n          url: this.$http.adornUrl('/inspection/inspectionlinepublish/list'),\r\n          method: 'get',\r\n          params: this.$http.adornParams({\r\n            'page': this.linePdaPageIndex,\r\n            'limit': this.linePdaPageSize,\r\n            'lineId': this.lineForm.lineId\r\n          })\r\n        }).then(({data}) => {\r\n          if (data && data.code === 0) {\r\n            this.linePdaList = data.page.list\r\n            this.linePdaTotalPage = data.page.totalCount\r\n          } else {\r\n            this.linePdaList = []\r\n            this.linePdaTotalPage = 0\r\n          }\r\n          this.linePdaListLoading = false\r\n        })\r\n      },\r\n      // 每页数\r\n      lineSizeChangeHandle (val) {\r\n        this.linePageSize = val\r\n        this.linePageIndex = 1\r\n        this.getLineList(this.lineForm.deptId)\r\n      },\r\n      // 每页数\r\n      turnSizeChangeHandle (val) {\r\n        this.turnPageSize = val\r\n        this.turnPageIndex = 1\r\n        this.getTurnList()\r\n      },\r\n      // 每页数\r\n      classGroupSizeChangeHandle (val) {\r\n        this.classGroupPageSize = val\r\n        this.classGroupPageIndex = 1\r\n        this.getClassGroupList()\r\n      },\r\n      // 每页数\r\n      periodSizeChangeHandle (val) {\r\n        this.periodPageSize = val\r\n        this.periodPageIndex = 1\r\n        this.getPeriodList()\r\n      },\r\n      // 每页数\r\n      lineZoneSizeChangeHandle (val) {\r\n        this.lineZonePageSize = val\r\n        this.lineZonePageIndex = 1\r\n        this.getLineZoneList()\r\n      },\r\n      // 每页数\r\n      linePdaSizeChangeHandle (val) {\r\n        this.linePdaPageSize = val\r\n        this.linePdaPageIndex = 1\r\n        this.getLinePdaList()\r\n      },\r\n      // 当前页\r\n      lineCurrentChangeHandle (val) {\r\n        this.linePageIndex = val\r\n        console.log('选择了线路'+this.lineSelected)\r\n        if(this.lineSelected){ // 选择了线路\r\n          this.lineForm.deptId = null\r\n          this.getLineList(null)\r\n        }else{\r\n          this.getLineList(this.lineForm.deptId)\r\n        }\r\n      },\r\n      // 当前页\r\n      turnCurrentChangeHandle (val) {\r\n        this.turnPageIndex = val\r\n        this.getTurnList()\r\n      },\r\n      // 当前页\r\n      classGroupCurrentChangeHandle (val) {\r\n        this.classGroupPageIndex = val\r\n        this.getClassGroupList()\r\n      },\r\n      // 当前页\r\n      periodCurrentChangeHandle (val) {\r\n        this.periodPageIndex = val\r\n        this.getPeriodList()\r\n      },\r\n      // 当前页\r\n      lineZoneCurrentChangeHandle (val) {\r\n        this.lineZonePageIndex = val\r\n        this.getLineZoneList()\r\n      },\r\n      // 当前页\r\n      linePdaCurrentChangeHandle (val) {\r\n        this.linePdaPageIndex = val\r\n        this.getLinePdaList()\r\n      },\r\n      // 选择线路\r\n      lineSelectionChangeHandle (val) {\r\n        if (val != null) {\r\n          this.isPublish = val.isPublish\r\n          if (val.isPublish === 0) {\r\n            this.publishIcon = 'el-icon-circle-check-outline'\r\n            this.publishName = '发布计划'\r\n          } else {\r\n            this.publishIcon = 'el-icon-edit-outline'\r\n            this.publishName = '修改计划'\r\n          }\r\n          this.lineForm.deptId = val.deptId\r\n          this.lineSelected = true\r\n          this.lineForm.lineId = val.id\r\n          this.lineForm.periodType = val.periodType\r\n          this.getDataList()\r\n        } else {\r\n          this.lineForm.lineId = 0\r\n          this.lineForm.periodType = 0\r\n          this.lineSelected = false\r\n        }\r\n      },\r\n      // 多选\r\n      turnSelectionChangeHandle (val) {\r\n        this.turnListSelections = val\r\n      },\r\n      // 多选\r\n      classGroupSelectionChangeHandle (val) {\r\n        this.classGroupListSelections = val\r\n      },\r\n      // 多选\r\n      periodSelectionChangeHandle (val) {\r\n        this.periodListSelections = val\r\n      },\r\n      // 多选\r\n      lineZoneSelectionChangeHandle (val) {\r\n        this.lineZoneListSelections = val\r\n      },\r\n      // 多选\r\n      linePdaSelectionChangeHandle (val) {\r\n        this.linePdaListSelections = val\r\n      },\r\n      // 新增 / 修改\r\n      lineAddOrUpdateHandle (id) {\r\n        this.lineAddOrUpdateVisible = true\r\n        this.$nextTick(() => {\r\n          this.$refs.lineAddOrUpdate.getDeptList()\r\n          this.$refs.lineAddOrUpdate.init(id)\r\n        })\r\n      },\r\n      // 新增 / 修改\r\n      turnAddOrUpdateHandle (id) {\r\n        this.turnAddOrUpdateVisible = true\r\n        this.$nextTick(() => {\r\n          this.$refs.turnAddOrUpdate.dataForm.inspectionLineId = this.lineForm.lineId\r\n          this.$refs.turnAddOrUpdate.getClassGroupList()\r\n          this.$refs.turnAddOrUpdate.init(id)\r\n        })\r\n      },\r\n      viewPublish (lineId) {\r\n        this.viewPublishVisible = true\r\n        this.$nextTick(() => {\r\n          this.$refs.viewPublish\r\n          this.$refs.viewPublish.getDataList(lineId)\r\n        })\r\n      },\r\n      classGroupAddOrUpdateHandle (id) {\r\n        this.classGroupAddOrUpdateVisible = true\r\n        this.$nextTick(() => {\r\n          this.$refs.classGroupAddOrUpdate.dataForm.inspectionLineId = this.lineForm.lineId\r\n          this.$refs.classGroupAddOrUpdate.getUserList()\r\n          this.$refs.classGroupAddOrUpdate.init(id, this.lineForm.deptId)\r\n        })\r\n      },\r\n      periodAddOrUpdateHandle (id) {\r\n        this.periodAddOrUpdateVisible = true\r\n        this.$nextTick(() => {\r\n          this.$refs.periodAddOrUpdate.periodType = this.lineForm.periodType\r\n          this.$refs.periodAddOrUpdate.dataForm.inspectionLineId = this.lineForm.lineId\r\n          this.$refs.periodAddOrUpdate.getTurnList()\r\n          this.$refs.periodAddOrUpdate.init(id)\r\n        })\r\n      },\r\n      zoneBindAddOrUpdateHandle (id) {\r\n        this.lineZoneAddOrUpdateVisible = true\r\n        this.$nextTick(() => {\r\n          this.$refs.zoneBindAddOrUpdate.dataForm.inspectionLineId = this.lineForm.lineId\r\n          this.$refs.zoneBindAddOrUpdate.init(this.lineForm.deptId)\r\n        })\r\n      },\r\n      pdaBindAddOrUpdateHandle (id) {\r\n        this.linePdaAddOrUpdateVisible = true\r\n        this.$nextTick(() => {\r\n          this.$refs.pdaBindAddOrUpdate.dataForm.inspectionLineId = this.lineForm.lineId\r\n          this.$refs.pdaBindAddOrUpdate.init(this.lineForm.deptId)\r\n        })\r\n      },\r\n      handleDeptSelect (val) {\r\n        this.lineList = []\r\n        this.turnList = []\r\n        this.classGroupList = []\r\n        this.periodList = []\r\n        this.lineForm.lineId = 0\r\n        this.lineForm.deptId = val\r\n        this.lineSelected = false\r\n        this.linePageIndex = 1\r\n        this.getLineList(this.lineForm.deptId)\r\n      },\r\n      tabSelectChangeHandle (val) {\r\n        this.classGroupPageIndex = 1\r\n        this.periodPageIndex = 1\r\n        this.turnPageIndex = 1\r\n        this.lineZonePageIndex = 1\r\n        this.linePdaPageIndex = 1\r\n        this.getDataList()\r\n      },\r\n      rowStyle ({row, rowIndex}) {\r\n        return 'height:25px'\r\n      },\r\n      cellStyle () {\r\n        return 'padding:0'\r\n      },\r\n      getDataList () {\r\n        if (this.activeTab === 'turn') {\r\n          this.getTurnList()\r\n        }\r\n        if (this.activeTab === 'class') {\r\n          this.getClassGroupList()\r\n        }\r\n        if (this.activeTab === 'period') {\r\n          this.getPeriodList()\r\n        }\r\n        if (this.activeTab === 'zone') {\r\n          this.getLineZoneList()\r\n        }\r\n        if (this.activeTab === 'pda') {\r\n          this.getLinePdaList()\r\n        }\r\n      },\r\n      // 删除\r\n      periodDeleteHandle (id) {\r\n        var ids = id ? [id] : this.periodListSelections.map(item => {\r\n          return item.id\r\n        })\r\n        this.$confirm(`确定解绑?`, '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.$http({\r\n            url: this.$http.adornUrl('/inspection/inspectionperiod/delete'),\r\n            method: 'post',\r\n            data: this.$http.adornData(ids, false)\r\n          }).then(({data}) => {\r\n            if (data && data.code === 0) {\r\n              this.$message({\r\n                message: '操作成功',\r\n                type: 'success',\r\n                duration: 1500,\r\n                onClose: () => {\r\n                  this.getPeriodList()\r\n                }\r\n              })\r\n            } else {\r\n              this.$message.error(data.msg)\r\n            }\r\n          })\r\n        })\r\n      },\r\n      // 删除\r\n      lineZoneDeleteHandle (id) {\r\n        var ids = id ? [id] : this.lineZoneListSelections.map(item => {\r\n          return item.id\r\n        })\r\n        this.$confirm(`确定解绑?`, '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.$http({\r\n            url: this.$http.adornUrl('/inspection/linezone/delete'),\r\n            method: 'post',\r\n            data: this.$http.adornData(ids, false)\r\n          }).then(({data}) => {\r\n            if (data && data.code === 0) {\r\n              this.$message({\r\n                message: '操作成功',\r\n                type: 'success',\r\n                duration: 1500,\r\n                onClose: () => {\r\n                  this.getLineZoneList()\r\n                }\r\n              })\r\n            } else {\r\n              this.$message.error(data.msg)\r\n            }\r\n          })\r\n        })\r\n      },\r\n      // 删除\r\n      lineDeleteHandle (id) {\r\n        var ids = id ? [id] : this.lineListSelections.map(item => {\r\n          return item.id\r\n        })\r\n       this.$confirm(`确定删除?`, '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.$http({\r\n            url: this.$http.adornUrl('/inspection/inspectionline/delete'),\r\n            method: 'post',\r\n            data: this.$http.adornData(ids, false)\r\n          }).then(({data}) => {\r\n            if (data && data.code === 0) {\r\n              this.$message({\r\n                message: '操作成功',\r\n                type: 'success',\r\n                duration: 1500,\r\n                onClose: () => {\r\n                  this.getLineList(this.lineForm.deptId)\r\n                }\r\n              })\r\n            } else {\r\n              this.$message.error(data.msg)\r\n            }\r\n          })\r\n        })\r\n      },\r\n      // 删除\r\n      turnDeleteHandle (id) {\r\n        var ids = id ? [id] : this.turnListSelections.map(item => {\r\n          return item.id\r\n        })\r\n        this.$confirm(`确定解绑?`, '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.$http({\r\n            url: this.$http.adornUrl('/inspection/turn/delete'),\r\n            method: 'post',\r\n            data: this.$http.adornData(ids, false)\r\n          }).then(({data}) => {\r\n            if (data && data.code === 0) {\r\n              this.$message({\r\n                message: '操作成功',\r\n                type: 'success',\r\n                duration: 1500,\r\n                onClose: () => {\r\n                  this.getTurnList()\r\n                }\r\n              })\r\n            } else {\r\n              this.$message.error(data.msg)\r\n            }\r\n          })\r\n        })\r\n      },\r\n      // 删除\r\n      classGroupDeleteHandle (id) {\r\n        var ids = id ? [id] : this.classGroupListSelections.map(item => {\r\n          return item.id\r\n        })\r\n        this.$confirm(`确定解绑?`, '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.$http({\r\n            url: this.$http.adornUrl('/inspection/classgroup/delete'),\r\n            method: 'post',\r\n            data: this.$http.adornData(ids, false)\r\n          }).then(({data}) => {\r\n            if (data && data.code === 0) {\r\n              this.$message({\r\n                message: '操作成功',\r\n                type: 'success',\r\n                duration: 1500,\r\n                onClose: () => {\r\n                  this.getClassGroupList()\r\n                }\r\n              })\r\n            } else {\r\n              this.$message.error(data.msg)\r\n            }\r\n          })\r\n        })\r\n      },\r\n      // 删除\r\n      pdaDeleteHandle (id) {\r\n        var ids = id ? [id] : this.linePdaListSelections.map(item => {\r\n          return item.id\r\n        })\r\n        this.$confirm(`确定解绑?`, '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.$http({\r\n            url: this.$http.adornUrl('/inspection/inspectionlinepublish/delete'),\r\n            method: 'post',\r\n            data: this.$http.adornData(ids, false)\r\n          }).then(({data}) => {\r\n            if (data && data.code === 0) {\r\n              this.$message({\r\n                message: '操作成功',\r\n                type: 'success',\r\n                duration: 1500,\r\n                onClose: () => {\r\n                  this.getLinePdaList()\r\n                }\r\n              })\r\n            } else {\r\n              this.$message.error(data.msg)\r\n            }\r\n          })\r\n        })\r\n      },\r\n      zoneBindEvent (val) {\r\n        var zoneIds = val.map(item => {\r\n          return item.zoneId\r\n        })\r\n        if (zoneIds.length > 0) {\r\n          this.$http({\r\n            url: this.$http.adornUrl('/inspection/linezone/bind'),\r\n            method: 'post',\r\n            params: this.$http.adornParams({\r\n              'lineId': this.lineForm.lineId\r\n            }),\r\n            data: this.$http.adornData(zoneIds, false)\r\n          }).then(({data}) => {\r\n            if (data && data.code === 0) {\r\n              this.$message({\r\n                message: '操作成功',\r\n                type: 'success',\r\n                duration: 1500,\r\n                onClose: () => {\r\n                  this.getLineZoneList()\r\n                }\r\n              })\r\n            } else {\r\n              this.$message.error(data.msg)\r\n            }\r\n          })\r\n        }\r\n      },\r\n      pdaBindEvent (val) {\r\n        var pdaIds = val.map(item => {\r\n          return item.pdaId\r\n        })\r\n        this.$http({\r\n          url: this.$http.adornUrl('/inspection/inspectionlinepublish/bind'),\r\n          method: 'post',\r\n          params: this.$http.adornParams({\r\n            'lineId': this.lineForm.lineId\r\n          }),\r\n          data: this.$http.adornData(pdaIds, false)\r\n        }).then(({data}) => {\r\n          if (data && data.code === 0) {\r\n            this.$message({\r\n              message: '操作成功',\r\n              type: 'success',\r\n              duration: 1500,\r\n              onClose: () => {\r\n                this.getLinePdaList()\r\n              }\r\n            })\r\n          } else {\r\n            this.$message.error(data.msg)\r\n          }\r\n        })\r\n      },\r\n      linePublish () {\r\n        if (this.lineForm.lineId === 0 || this.lineForm.lineId === null) {\r\n          this.$alert('请选择线路')\r\n          return\r\n        }\r\n        if (this.publishName === '修改计划') {\r\n          this.$confirm(`确定将线路由已发布状态改为编操状态作?`, '提示', {\r\n            confirmButtonText: '确定',\r\n            cancelButtonText: '取消',\r\n            type: 'warning'\r\n          }).then(() => {\r\n            this.$http({\r\n              url: this.$http.adornUrl('/inspection/inspectionline/update'),\r\n              method: 'post',\r\n              data: this.$http.adornData({\r\n                'id': this.lineForm.lineId,\r\n                'isPublish': 0\r\n              })\r\n            }).then(({data}) => {\r\n              if (data && data.code === 0) {\r\n                this.$message({\r\n                  message: '操作成功',\r\n                  type: 'success',\r\n                  duration: 1500,\r\n                  onClose: () => {\r\n                    console.log('选择了线路'+this.lineSelected)\r\n                    if(this.lineSelected){ // 选择了线路\r\n                      this.lineForm.deptId = null\r\n                      this.getLineList(null)\r\n                    }else{\r\n                      this.getLineList(this.lineForm.deptId)\r\n                    }\r\n                    // this.getLineList(null)\r\n                    this.isPublish = 0\r\n                  }\r\n                })\r\n              } else {\r\n                this.$message.error(data.msg)\r\n              }\r\n            })\r\n          })\r\n        }\r\n\r\n        if (this.publishName === '发布计划') {\r\n          this.$http({\r\n            url: this.$http.adornUrl(`/inspection/inspectionline/publish/${this.lineForm.lineId}`),\r\n            method: 'post'\r\n          }).then(({data}) => {\r\n            if (data && data.code === 0) {\r\n              this.$message({\r\n                message: '操作成功',\r\n                type: 'success',\r\n                duration: 1500,\r\n                onClose: () => {\r\n                  // this.getLineList(this.lineForm.deptId)\r\n                  console.log('选择了线路'+this.lineSelected)\r\n                  if(this.lineSelected){ // 选择了线路\r\n                    this.lineForm.deptId = null\r\n                    this.getLineList(null)\r\n                  }else{\r\n                    this.getLineList(this.lineForm.deptId)\r\n                  }\r\n                  // this.getLineList(null)\r\n                  this.isPublish = 1\r\n                }\r\n              })\r\n            } else {\r\n              this.$message.error(data.msg)\r\n            }\r\n          })\r\n        }\r\n      },\r\n      // 跳转到 对应的巡区页面\r\n      clickToZone (zoneName) {\r\n        if (this.isAuth('inspection:zone:list')) {\r\n          this.$router.push({name: 'inspection-zone', params: {zoneName: zoneName}})\r\n        } else {\r\n          this.$alert('您没有开通页面权限')\r\n        }\r\n      },\r\n      // 跳转到 对应的Pda 页面\r\n      clickToPda (pdaName) {\r\n        if(this.isAuth('inspection:pda:list')){\r\n          this.$router.push({name: 'inspection-pda', params: {pdaName: pdaName}})\r\n        } else {\r\n          this.$alert('您没有开通页面权限')\r\n        }\r\n      },\r\n      startLoading: function() {\r\n        loading = Loading.service({\r\n            lock: true,\r\n            text: '加载中……',\r\n            background: 'rgba(0, 0, 0, 0.7)'\r\n        })\r\n      },\r\n      endLoading: function() {\r\n          loading.close()\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped=\"\" lang=\"scss\">\r\n  .mod-inspection-line{\r\n    .el-form{\r\n      /deep/ .el-form-item{\r\n        margin-bottom: 5px;\r\n      }\r\n    }\r\n    .el-tabs{\r\n      /deep/ .el-tabs__item{\r\n        height: 30px;\r\n        line-height: 30px;\r\n      }\r\n    }\r\n    .bottom_data{\r\n      height: 100%;\r\n      display: flex;\r\n      flex-direction: column;\r\n      .el-table{\r\n        flex: 1;\r\n        // /deep/ .cell{\r\n        //   min-height: 32px;\r\n        // }\r\n      }\r\n    }\r\n    /deep/ .el-table--medium th{\r\n      padding: 4px 0;\r\n    }\r\n  }\r\n  .show-data-up{\r\n    margin: 0 !important;\r\n  }\r\n  .site-content .show-data-table{\r\n    padding: 10px;\r\n  }\r\n  .site-wrapper .el-pagination{\r\n    margin-top: 8px;\r\n  }\r\n  .xunxian{\r\n    /deep/ .el-tabs__content{\r\n      height: calc(100% - 29px);\r\n      .el-tab-pane{\r\n        height: 100%;\r\n      }\r\n    }\r\n  }\r\n</style>\r\n\r\n\r\n"
        }
    ]
}